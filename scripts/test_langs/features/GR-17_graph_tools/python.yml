# GR-17: Graph Tools Tests (Python Language)
#
# Verifies that graph analysis tools work correctly for Python code.
# Tests tool invocation, parameters, and Python-specific adaptations.

metadata:
  feature: GR-17
  title: "Graph Analysis Tools"
  language: python
  project: flask
  ticket: tickets/merged/GR-17_graph_tools.md
  description: >
    Tests CRS graph tool integration for Python code. Verifies that specialized
    graph analysis tools work correctly for Python modules, decorators,
    and Flask application structure.

tests:
  - id: 191
    name: py_find_articulation_basic
    category: FIND_ARTICULATION
    description: >
      Basic find_articulation_points tool query for Python code.
      Should identify critical functions in the Flask app whose removal
      would disconnect the module dependency graph.
    query: |
      What are the single points of failure in this Flask application?
    expected_state: COMPLETE
    validations:
      - type: find_articulation_points_tool_used

  - id: 192
    name: py_find_articulation_bridges
    category: FIND_ARTICULATION
    description: >
      find_articulation_points with include_bridges for Python code.
      Should find both critical functions and critical import relationships.
    query: |
      Find critical bottleneck functions and the critical imports connecting them
    expected_state: COMPLETE
    validations:
      - type: find_articulation_points_bridges

  - id: 194
    name: py_find_dominators_basic
    category: FIND_DOMINATORS
    description: >
      Basic find_dominators tool query for Python code.
      Should find all functions that must execute before reaching
      a target in the Flask request lifecycle.
    query: |
      What functions dominate the request handler function?
    expected_state: COMPLETE
    validations:
      - type: find_dominators_tool_used

  - id: 195
    name: py_find_dominators_tree
    category: FIND_DOMINATORS
    description: >
      find_dominators with show_tree for Python code.
      Should return the dominator tree structure for Flask app modules.
    query: |
      Show the dominator tree starting from create_app
    expected_state: COMPLETE
    validations:
      - type: find_dominators_tree

  - id: 197
    name: py_find_merge_points_basic
    category: FIND_MERGE_POINTS
    description: >
      Basic find_merge_points tool query for Python code.
      Should find convergence points in Flask request handling
      where different middleware chains merge.
    query: |
      Where do different request paths converge in this Flask app?
    expected_state: COMPLETE
    validations:
      - type: find_merge_points_tool_used

  - id: 198
    name: py_find_merge_points_sources
    category: FIND_MERGE_POINTS
    description: >
      find_merge_points with specific sources for Python code.
      Should find where auth and api blueprints merge in Flask.
    query: |
      Find merge points for auth blueprint and api blueprint functions
    expected_state: COMPLETE
    validations:
      - type: find_merge_points_sources

  - id: 200
    name: py_find_loops_basic
    category: FIND_LOOPS
    description: >
      Basic find_loops tool query for Python code.
      Should detect recursive patterns and circular imports
      in Python modules.
    query: |
      Find recursive functions and circular imports in this Flask application
    expected_state: COMPLETE
    validations:
      - type: find_loops_tool_used

  - id: 201
    name: py_find_loops_min_size
    category: FIND_LOOPS
    description: >
      find_loops with min_size for Python code.
      Should find mutual recursion with at least N functions involved.
    query: |
      Find mutual recursion patterns with at least 2 functions involved
    expected_state: COMPLETE
    validations:
      - type: find_loops_min_size

  - id: 203
    name: py_find_common_dependency_basic
    category: FIND_COMMON_DEPENDENCY
    description: >
      Basic find_common_dependency tool query for Python code.
      Should find the lowest common dependency between two Flask
      functions or blueprints.
    query: |
      What is the common dependency between auth routes and api routes?
    expected_state: COMPLETE
    validations:
      - type: find_common_dependency_tool_used

  - id: 204
    name: py_find_common_dependency_entry
    category: FIND_COMMON_DEPENDENCY
    description: >
      find_common_dependency with entry point for Python code.
      Should find LCD relative to create_app entry point.
    query: |
      Find the lowest common dominator of AuthService and UserService from create_app
    expected_state: COMPLETE
    validations:
      - type: find_common_dependency_entry

  - id: 206
    name: py_find_control_deps_basic
    category: FIND_CONTROL_DEPS
    description: >
      Basic find_control_dependencies tool query for Python code.
      Should identify which conditionals control whether
      a Flask route handler executes.
    query: |
      What conditionals control whether the login route handler executes
    expected_state: COMPLETE
    validations:
      - type: find_control_deps_tool_used

  - id: 207
    name: py_find_control_deps_depth
    category: FIND_CONTROL_DEPS
    description: >
      find_control_dependencies with depth for Python code.
      Should limit search depth for control dependencies.
    query: |
      Show control dependencies for register_user function with depth 3
    expected_state: COMPLETE
    validations:
      - type: find_control_deps_depth

  - id: 209
    name: py_find_extractable_basic
    category: FIND_EXTRACTABLE
    description: >
      Basic find_extractable_regions tool query for Python code.
      Should find SESE regions in Flask app that can be extracted
      into separate helper functions.
    query: |
      Find code regions in this Flask app that can be safely extracted into separate functions
    expected_state: COMPLETE
    validations:
      - type: find_extractable_tool_used

  - id: 210
    name: py_find_extractable_size
    category: FIND_EXTRACTABLE
    description: >
      find_extractable_regions with size for Python code.
      Should find SESE regions within a specific size range.
    query: |
      Find extractable regions between 5 and 30 nodes in size
    expected_state: COMPLETE
    validations:
      - type: find_extractable_size
